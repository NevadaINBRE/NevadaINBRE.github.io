---
title: 'Introduction to R: Part Three'
output: html_document
---

## Data Visualization

In this part of the workshop we will go over how to create data visualizations. We will briefly talk about how to create plots using base R. 

## Producing simple plots

There are a few simple plotting functions in R

- `plot()`
  - also "generic"
  - can produce scatter and line plots
- `lines()` or `abline()` adds lines to plots
- `points()` adds points to plots
- `curve()` plots a function over a domain
  - can be used alone or "layered" on top of an existing plot

Other types of graphs include

- `hist()` for histograms
- `barplot()`
- `boxplot()`
- `stem()` for stem-and-leaf plot

You can control other parts of the graph using these arguments
  -main: an overall title for the plot
  -sub:a subtitle for the plot
  -xlab/ ylab:a title for the x and y axis
  -aspL y/x aspect ratio

```{r}
y<-mtcars$mpg #miles per gallon
x<-round(mtcars$wt) *1000 #weight (1000lbs)
mtcars<-mtcars
boxplot(y~x, xlab="Weight rounded to nearest 1000 lbs", ylab="mpg" )
hist(y, main="Histogram of mpg", xlab="mpg") 
plot(mpg~wt, data=mtcars, col="blue", xlab="weight (1000lbs)", asp=0.05)
  abline(lm(mpg~wt, data=mtcars), lty="dotted")
```


### Practice

Call the `iris` data set, which is preloaded data similar to `mtcars` but was collected by a botanist and give it a variable name in this environment. Explore this dataset. Next create a column that calculates the ratio of Sepal length:Petal Length. Next create a plot of the Sepal:Petal length ratio separated into species. Give the plot a main title and label the axes


```{r}
library(tidyverse)
iris<-iris
?iris

```
## Customization of plots

### Colors

R allows you to customize colors. It can understand some basic text color names as well as Hex codes.
```{r} 
#list of text color names
colors() 
```

### Linetypes

Linetypes (Lty in base R) can either be text (“blank”, “solid”, “dashed”, “dotted”, “dotdash”, “longdash”, “twodash”) or number (0, 1, 2, 3, 4, 5, 6).

### Shapes

Shapes (pch in base R) can also be text or numbers. 
pch = 0,square
pch = 1,circle
pch = 2,triangle point up
pch = 3,plus
pch = 4,cross
pch = 5,diamond
pch = 6,triangle point down
pch = 7,square cross
pch = 8,star
pch = 9,diamond plus
pch = 10,circle plus
pch = 11,triangles up and down
pch = 12,square plus
pch = 13,circle cross
pch = 14,square and triangle down
pch = 15, filled square
pch = 16, filled circle
pch = 17, filled triangle point-up
pch = 18, filled diamond
pch = 19, solid circle
pch = 20,bullet (smaller circle)
pch = 21, filled circle blue
pch = 22, filled square blue
pch = 23, filled diamond blue
pch = 24, filled triangle point-up blue
pch = 25, filled triangle point down blue

## GGplots 

`ggplot2` is a tidyverse package for making visualizations. It takes some time to get used to but a lot of R users use ggplot to create publication ready figures. There are also a lot of packages that interact with ggplot to make graphs the way you want them to look. I am going to spend most the time going over how to create ggplots because it is a very versatile system once you get a hang of the syntax. The cheat sheet for ggplot2 is very helpful. The base ggplot syntax is as follows: 

>ggplot(data=<DATA>)+
  <geom_function>(mapping = aes(x=, y=, color=, group=, linetype=))+ 
  <theme_function>+
  <scale_function>+
  <facet_function>+
  <coordinate_function>

- Geom functions represent the type of plot (line, point, boxplot, etc.). Each geom function layers on the plot so you can have multiple types of plot. 
  - The aesthetic properties define the axes, and other groupings (such a variable defining color)
  - There are usually other properties you can define outside of the mapping such as the whole geom function having a certain color or size
- Theme functions customize aspects such as axis, legend, panel, and facet properties
- Scale functions are used to customize the color, shapes, and axis scales (e.g. log scales)
- Facet functions divide a plot into subplots based on 1+ discrete variables
- Coordinate functions can change the plot from default Cartesian coordinates to maps or different aspects

Here is an example replicating a graph we made using base R

```{r}
ggplot(data=mtcars)+
  geom_point(mapping=aes(x=wt, y= mpg), col="blue") +
  geom_smooth(mapping = aes(wt, mpg), method = lm, linetype="dotted")+
  theme_classic()+
  labs(x="Weight (1000lbs)", y="mpg")#changing label names
```

ggplot makes it easy to distinguish between lot of variables and customize colors:
```{r}
ggplot(data=mtcars)+
  geom_point(mapping=aes(x=wt, y= mpg, col=am)) + 
  geom_smooth(mapping = aes(wt, mpg), method = lm)+
  theme_classic()+
  labs(x="Weight (1000lbs)", y="mpg")

#ggplot thinks of am as a continuous variable. To change that we are going to have to edit that  column
mtcars_edited<-mutate(mtcars, trans=ifelse(am==0, "Automatic Transmission","Manual Tranmission" ))
ggplot(data=mtcars_edited)+
  geom_point(mapping=aes(x=wt, y= mpg, col=trans)) + 
  geom_smooth(mapping = aes(wt, mpg, linetype=trans, col=trans), method = lm)+
  theme_classic()+
  scale_color_manual(values=c("blue","red"), name="Transmission Type")+
  scale_linetype(name="Transmission Type")+
  labs(x="Weight (1000lbs)", y="mpg")

# here is an example of how facets can be used 
ggplot(data=mtcars_edited)+
  geom_point(mapping=aes(x=wt, y= mpg, col=trans)) + 
  geom_smooth(mapping = aes(wt, mpg, linetype=trans, col=trans), method = lm)+
  theme_classic()+
  facet_grid(cols=vars(trans))+
  scale_color_manual(values=c("blue","red"), name="Transmission Type")+
  scale_linetype(name="Transmission Type")+
  labs(x="Weight (1000lbs)", y="mpg")

```

### Practice

Fix the following code that is making a boxplot of the % C of soil samples by timing. Add a scale function to customize colors, a facet function to separate by Location (col) and treatment (row), and add axis labels
```{r}
urlfile="https://raw.githubusercontent.com/NevadaINBRE/NevadaINBRE.github.io/main/NSC_workshop/Soil_data.csv"
suppressMessages(soil_data<-read_csv(url(urlfile)))
ggplot(data=soil_data)%>%
  geom_boxplot(x=Timing, y=C, col=Timing)+
  theme_classic()

```


## Selecting the right type of plot

The practice plot gives an example of a plot that is not very useful for telling a story about data. Since different locations have different treatments, we are left with a grid that has a lot of blanks. When determining what type of graph should be use and what variable to split on, it mostly depends on what question you are asking. If we are looking at how the carbon changes between before and after infiltrating plots with water at the three locations, then we can change the the plot so treatment is no longer shown. 

```{r}
ggplot(data=soil_data)+
  geom_boxplot(aes(x=Timing, y=C, col=Timing))+
  theme_classic()+
  facet_grid(cols=vars(Location))

soil_data_NSWC<-filter(soil_data, Treatment %in% c("NS","WC"))

ggplot(data=soil_data_NSWC)+
  geom_boxplot(aes(x=Timing, y=C, col=Timing))+
  theme_classic()+
  facet_grid(cols=vars(Location), rows=vars(Treatment))

ggplot(data=soil_data_NSWC)+
  geom_boxplot(aes(x=Treatment, y=C, col=Treatment))+
  theme_classic()+
  facet_grid(cols=vars(Location), rows=vars(Timing))
```
It is also important to understand the types of variables you are working with:

- Continuous variables
- Discrete variables

Here are the geom_function for different combinations of variables.
- One continuous variable
  - area
  - density
  - dotplot
  - freqpoly
  - histogram
- One discrete variable
  - bar
- Two continuous variables
  - label
  - point
  - quantile
  - rug
  - smooth
  - text
  - bin2d
  - density_2d
  - hex
  - line
  - step
- One discrete variable, One continuous
  - col
  - boxplot
  - dotplot
  - violin
- Two discrete variables
  - count
  - jitter
- Three variables
  - contour
  - raster
  - tile
- Other 
  - map
  - crossbar
  - errorbar

Other things to consider while creating plots include:

- Using colorblind safe colors
- When possible differentiate variables into different ways

## More Complex Graphs and data wrangling

Sometimes a data frame is not set up to create the graphs you want so you can use the functions `pivot_longer` or `pivot_wider` to make it more useful. For example if we want to look at the averages of % Carbon and % Nitrogen  together on the same plot, we can use `pivot_longer`

```{r}
longer_soil<-pivot_longer(soil_data, cols= c(C,N), names_to = "Chemical", values_to = "weight"  )

ggplot(data=longer_soil)+
  geom_boxplot(aes(x=Chemical, y=weight, col=Chemical))+
  theme_classic()+
  facet_grid(cols = vars(Location), rows=vars(Timing))
#Turning Timing into a factor so it is ordered Before to After. 
longer_soil$Timing<-factor(longer_soil$Timing, levels=c("Before","After"), ordered = TRUE)
ggplot(data=longer_soil)+
  geom_boxplot(aes(x=Chemical, y=weight, col=Chemical))+
  theme_classic()+
  facet_grid(cols = vars(Location), rows=vars(Timing))+
  labs(x="",y="% weight")
 
```
 
Another type of plot that is useful for soil scientist is depth profiles. 

```{r}
ggplot(soil_data)+
  geom_smooth(aes(x=depth_below_plot_cm,  y=C), color="chocolate4")+
  scale_x_reverse() +
  coord_flip() +
  theme_classic()+
  facet_grid(cols=vars(Location))+
  labs(y="Percent", x="Depth below plot (cm)")
  
#geom_smooth(aes(x=depth_below_plot_cm,  y=N), color="darkslategray3")
```
### Practice 

Create a soil profile of % Sand, Silt, and Clay at all three locations.

```{r}

```


## Questions 



## Microbiome file download
```{r}
download.file(url="https://raw.githubusercontent.com/NevadaINBRE/NevadaINBRE.github.io/main/NSC_workshop/Microbiome.Rmd", destfile =  "Intro_to_R_workshop_dataviz.Rmd")
```
